## 规范数据库设计

### 理由

==**当数据库比较复杂的时候，我们就需要设计了**== 

**糟糕的数据库设计：** 

- 数据冗余，浪费空间
- 数据库插入和删除都会麻烦，异常(屏蔽使用物理外键)
- 程序的性能差

**良好的数据库设计：** 

- 节省内存空间
- 保证数据库的完整性
- 方便我们开发系统

**软件开发中，关于数据库的设计** 

- 分析需求：分析业务和需要处理的数据库的需求
- 概要设计：设计关系图 E-R 图



**设计数据库的步骤：(个人博客)** 

- 收集信息，分析需求
    - 用户表：用户登录注销，用户的个人信息，写博客，创建分类
    - 分类表：文章分类
    - 文章表：文章的信息
    - 发链表：友链信息
    - 自定义表：系统信息，某个关键的字，或者一些主字段   key:value
- 标识实体 (把需求落地到每个字段)
- 标识实体之间的关系
    - 写博客：user--->blog
    - 创建分类：user--->catagory
    - 关注：user--->user
    - 友链：links
    - 评论：user--->user--->blog



### 三大范式

#### 数据库的三大设计范式

1. 第一范式

    - 数据表中的所有字段都是不可分割的原子值
    - 字段尽可能的拆分，范式设计的越详细对于某些实际操作可能更好，但是需要从实际出发

    举例说明：

    ![img](https://images2018.cnblogs.com/blog/1218459/201809/1218459-20180909201651535-1215699096.png)

    在上面的表中，“家庭信息”和“学校信息”列均不满足原子性的要求，故不满足第一范式，调整如下：

    ![img](https://images2018.cnblogs.com/blog/1218459/201809/1218459-20180909202243826-1032549277.png)

2. 第二范式

    - 必须是满足第一范式的前提下
    - 第二范式要求，除主键外的每一列都必须完全依赖于主键
    - 如果要出现不完全依赖，只可能发生在联合主键（表约束）的情况下
    - 拆表

    举例说明：

    ![img](https://images2018.cnblogs.com/blog/1218459/201809/1218459-20180909204750951-639647799.png) 

    在上图所示的情况中，同一个订单中可能包含不同的产品，因此主键必须是“订单号”和“产品号”联合组成，

    但可以发现，产品数量、产品折扣、产品价格与“订单号”和“产品号”都相关，但是订单金额和订单时间仅与“订单号”相关，与“产品号”无关，

    这样就不满足第二范式的要求，调整如下，需分成两个表：

    ![img](https://images2018.cnblogs.com/blog/1218459/201809/1218459-20180909210444227-1008056975.png) ![image-20210516103549220](https://img2020.cnblogs.com/blog/2213660/202105/2213660-20210516103550252-99776489.png) 

3. 第三范式

    - 必须满足第二范式
    - 除开主键列的其他列之间不能有传递依赖关系
    - 需要确保数据表中的每一列数据都和主键直接相关，而不能间接相关。

    举例说明：

    ![img](https://images2018.cnblogs.com/blog/1218459/201809/1218459-20180909211311408-1364899740.png)

    上表中，所有属性都完全依赖于学号，所以满足第二范式，但是“班主任性别”和“班主任年龄”直接依赖的是“班主任姓名”，

    而不是主键“学号”，所以需做如下调整：

    ![img](https://images2018.cnblogs.com/blog/1218459/201809/1218459-20180909211539242-1391100354.png) ![image-20210516102444823](https://img2020.cnblogs.com/blog/2213660/202105/2213660-20210516102445843-554358335.png)



#### 规范性和性能的问题

- 考虑商业化的需求和目标，(成本，用户体验！)数据库的性能更加重要
- 在规范性能的问题的时候，需要考虑一下规范性！
- 故意给某些表增加一些冗余的字段。(从多表查询中变为单表查询)
- 故意增加一些计算列(从大数据量降低为小数据量)





